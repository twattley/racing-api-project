#!/bin/zsh
source "$(dirname "$0")/setup_env" "racing-api"
export PYTHONPATH="$(pwd)"

# Kill any process listening on port 3000 (macOS)
PIDS=$(lsof -ti tcp:8000 || true)
if [[ -n "$PIDS" ]]; then
  echo "Killing process(es) on port 8000: $PIDS"
  kill -TERM $PIDS 2>/dev/null || true
  sleep 1
  kill -KILL $PIDS 2>/dev/null || true
fi

uvicorn racing_api.main:app --host 0.0.0.0 --port 8000 --reload