#!/bin/zsh

set -e

LOG_BASE_DIR="$HOME/App/racing-api-project/racing-api-project/logs/racing-etl"

mkdir -p "$LOG_BASE_DIR"

LOG_FILE_NAME="execution_$(date +%Y_%m_%d).log"
LOG_FULL_PATH="${LOG_BASE_DIR}/${LOG_FILE_NAME}"

source "$(dirname "$0")/setup_env" "racing-etl"

export PYTHONPATH="$(pwd)"

# Redirect all output (stdout and stderr) to the dated log file
exec >> "$LOG_FULL_PATH" 2>&1

echo "ETL execution started at $(date)"

python -m racing_etl.main --headless true "$@"

echo "ETL execution completed at $(date)"